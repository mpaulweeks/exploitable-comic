function Grid(){
  var g = {};
  g.data = {};
  g.size = 0;

  g.get = function(x, y){
    return (g.data[x] || {})[y];
  }
  g.getPixel = function(p){
    return g.get(p.x, p.y);
  }

  g.set = function(x, y, value){
    if (!g.get(x,y)){
      g.size += 1;
    }
    var dataX = g.data[x] || {};
    dataX[y] = value;
    g.data[x] = dataX;
  }
  g.setPixel = function(p, optionalValue){
    return g.set(p.x, p.y, p || optionalValue);
  }

  g.getValues = function(){
    var values = [];
    for (var x in g.data){
      var dataX = g.data[x];
      for (var y in dataX){
        var value = dataX[y];
        values.push(value);
      }
    }
    return values;
  }

  return g;
}

function Group(grid){
  var g = grid || Grid();

  g.getVerticalSlices = function(){
    // unused
    var minX = Math.min(...Object.keys(g.data));
    var maxX = Math.max(...Object.keys(g.data));
    var minY = null;
    var maxY = null;
    var slices = [];
    for (var x in g.data){
      var dataX = g.data[x];
      var min = Math.min(...Object.keys(dataX));
      var max = Math.max(...Object.keys(dataX));
      if (minY == null || min < minY){
        minY = min;
      }
      if (maxY == null || max > maxY){
        maxY = max;
      }
      var rowData = {
        x: x,
        min: min,
        max: max
      };
      slices.push(rowData);
    }
    po(slices.length);
    g.rect = {
      minX: minX,
      maxX: maxX,
      minY: minY,
      maxY: maxY
    };
    return slices;
  }
  
  g.getHorizontalSlices = function(){
    var allPixels = g.getValues();
    var fg = Grid();
    allPixels.forEach(function (p){
      fg.set(p.y, p.x, true);
    });
    
    var minX = null;
    var maxX = null;
    var slices = [];
    for (var y in fg.data){
      var dataY = fg.data[y];
      var min = Math.min(...Object.keys(dataY));
      var max = Math.max(...Object.keys(dataY));
      if (max - min > 50){
        if (minX == null || min < minX){
          minX = min;
        }
        if (maxX == null || max > maxX){
          maxX = max;
        }
        var rowData = {
          y: y,
          min: min,
          max: max
        };
        slices.push(rowData);
      }
    }
    var sliceYs = [];
    slices.forEach(function(s){
      sliceYs.push(s.y);
    });
    var minY = Math.min(...sliceYs);
    var maxY = Math.max(...sliceYs);
    po(slices.length);
    g.rect = {
      minX: minX,
      maxX: maxX,
      minY: minY,
      maxY: maxY
    };
    return slices;
  }
  
  return g;
}