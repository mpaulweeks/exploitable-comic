
function init(){

var comicSrc = "img/sampleComic.gif";
var fillSrc = "img/sampleFill.png";

function runProcessor(canvas, fillImg){  
  var pm = PixelManager(canvas);
  po('loaded image');

  po('searching for text bubbles...');
  var groups = pm.getContiguousWhite();
  po(groups.length + ' groups found')
  groups = pm.vetGroups(groups);
  po(groups.length + ' groups vetted');

  po('replacing text bubbles...');
  pm.replaceGroups(groups, fillImg);
  po('done!');

  var editedTag = document.getElementById('edited');
  var dataURL = canvas.toDataURL();
  editedTag.src = dataURL;
  $('#loading').hide();
}

function loadImages(canvas){
  $('#loading').show();
  $('#comic').attr('src', comicSrc);
  $('#fill').attr('src', fillSrc);
  $('#edited').attr('src', '');
  var comicImg = new Image;
  comicImg.crossOrigin = "Anonymous";
  comicImg.onload = function() {
    canvas.width = comicImg.width;
    canvas.height = comicImg.height;
    canvas.getContext("2d").drawImage(comicImg, 0, 0);

    var fillImg = new Image;
    fillImg.crossOrigin = "Anonymous";
    fillImg.onload = function() {
      setTimeout(function (){
        runProcessor(canvas, fillImg);
      }, 1);
    };
    fillImg.src = fillSrc;
  };
  comicImg.src = comicSrc;
}

function handleImage(e, callback){
  var reader = new FileReader();
  reader.onload = function(event){
      callback(event.target.result);
  }
  reader.readAsDataURL(e.target.files[0]);
}

// on page load
var canvas = document.getElementById("canvas");

var imageLoader = document.getElementById('imageLoader');
imageLoader.addEventListener('change', function(e){
  handleImage(e, function(newcomicSrc){
    comicSrc = newcomicSrc;
    loadImages(canvas);
  });
}, false);
var fillLoader = document.getElementById('fillLoader');
fillLoader.addEventListener('change', function(e){
  handleImage(e, function(newFillSrc){
    fillSrc = newFillSrc;
    loadImages(canvas);
  });
}, false);

loadImages(canvas);

}
